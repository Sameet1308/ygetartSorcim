from mstrio.connection import Connection
from mstrio.project import Project
from mstrio.cube import list_cubes

# Replace these variables with your actual details
base_url = 'https://your-microstrategy-server.com/MicroStrategyLibrary/api'
username = 'your_username'
password = 'your_password'

# Connect to MicroStrategy
conn = Connection(base_url=base_url, username=username, password=password, login_mode=1)

# Fetch all projects
projects = Project.list(conn)

# Dictionary to store project names and their cubes
project_cubes = {}

for project in projects:
    # Set the project context for this iteration
    conn.set_project(project.name)

    # List all cubes in the current project
    cubes = list_cubes(conn, project_id=project.id, error_msg="Failed to fetch cubes.")

    # Storing cubes in the dictionary
    project_cubes[project.name] = [cube.name for cube in cubes]

    # Optionally, reset project context if needed elsewhere
    conn.reset_project()

# Disconnect from MicroStrategy
conn.close()

# Print or process the dictionary of projects and their cubes
print(project_cubes)